<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>Shipping and Payment Details | Winston's Humidor</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap core CSS -->
    <link href="css/style.css" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet" />
    <link href="css/font-awesome.min.css" rel="stylesheet" />


</head>

<body style="background-color:white">


    <!-- We hide the side nav bar only on full desktop view and will show the top navbar instead. -->
    <nav class="menu hidden-lg hidden-xl" id="theMenu">
        <div class="menu-wrap">
            <h1 class="logo"><img src="images/WinstonHumidor_Cigar_Brown(2).png" class="img-responsive center-block" style="max-width:100px" /></h1>
            <i class="icon-remove menu-close"></i>
            <a href="index.html" class="smoothScroll">Home</a>
            <a href="Cigars.html" class="smoothScroll">Cigars</a>
            <a href="Pipes.html" class="smoothScroll">Pipes</a>
            <a href="PipeTobacco.html" class="smoothScroll">Pipe Tobacco</a>
            <a href="Apparel.html" class="smoothScroll">Apparel</a>
            <a href="Accessories.html" class="smoothScroll">Accessories</a>
            <a href="Coffee.html" class="smoothScroll">Coffee</a>
            <a href="Events.html" class="smoothScroll">Blog / Events</a>
            <a href="#" data-toggle="modal" data-target="#contactModal">Contact</a>
            <a id="myCart" data-toggle='modal' data-target='#viewCartModal' href="#" class="smoothScroll cartme">Cart (<span id="cartcount"></span>)</a>

            <a href="#"><i class="icon-facebook"></i></a>
            <a href="#"><i class="icon-twitter"></i></a>
            <a href="#"><i class="icon-instagram"></i></a>
        </div>
        <!-- Menu button -->
        <div id="menuToggle"><i class="icon-reorder"></i></div>
    </nav>

    <nav id="topnav" class="navbar hidden-xs hidden-sm hidden-md navbar-fixed-top" role="navigation" style="margin-bottom:0px;padding:15px;background-color:rgba(01,01,01,1)">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

        </div>
        <a id="brandlogo" class="navbar-brand" href="index.html"><img src="images/WinstonHumidor_Cigar_Brown.png" class="img img-responsive center-block " style="height:125px;" /></a>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="navbar-collapse-1">

            <ul class="nav navbar-nav navbar-left">
                <li><a href="#" data-toggle="modal" data-target="#contactModal">Contact</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Shop <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="Cigars.html" class="smoothScroll">Cigars</a></li>
                        <li><a href="Pipes.html" class="smoothScroll">Pipes</a></li>
                        <li><a href="PipeTobacco.html" class="smoothScroll">Pipe Tobacco</a></li>
                        <li><a href="Apparel.html" class="smoothScroll">Apparel</a></li>
                        <li><a href="Accessories.html" class="smoothScroll">Accessories</a></li>
                        <li><a href="Coffee.html" class="smoothScroll">Coffee</a></li>

                    </ul>
                </li>
                <!--<li><a href="#">About</a></li>-->
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="Events.html">Blog / Events</a></li>
                <!--<li><a href="#">Login</a></li>-->
                <li><a id="myCart2" data-toggle='modal' data-target='#viewCartModal' href="#" class="smoothScroll cartme">Cart (<span id="cartcount2"></span>)</a></li>
                <li><a href="#"></a></li>

            </ul>
        </div><!-- /.navbar-collapse -->
    </nav>

    <div class="modal fade" id="contactModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="background-color:rgba(01,01,01,0.7)">
        <div class="modal-dialog" role="document">
            <div class="modal-content">

                <div>
                    <div class="col-lg-12 text-center" style="padding:0px">


                        <div class="embed-responsive embed-responsive-4by3">
                            <iframe class="embed-responsive-item" width="600" height="450" frameborder="0" style="border:0" src="https://www.google.com/maps/embed/v1/place?q=Winston's%20Humidor%2C%20Village%20Place%20Drive%2C%20Midlothian%2C%20VA%2C%20United%20States&key=AIzaSyAcBygQuhrqbsfdVtXDhyq5VE6MhL01ids" allowfullscreen></iframe>
                        </div>

                        <div class="col-lg-12 text-center">
                            <h3 style="font-family:'chiser'"><a href="tel:+18043792985"><b>(804) 379-2985</b></a></h3>

                            <h3 style="font-family:'chiser'"><a href="mailto:info@winstonshumidor.com"><b>info@winstonshumidor.com</b></a></h3>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-news" data-dismiss="modal"><i class="glyphicon glyphicon-remove"></i></button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="loginmodal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="background-color:rgba(01,01,01,0.7)">
        <div class="modal-dialog" role="document">
            <div class="modal-content" style="padding:5%">
                <input id="txtLoginEmail" style="font-family:'chiser'" class="form-control" placeholder="Email" />
                <br />
                <input id="txtLoginPassword" type="password" style="font-family:'chiser'" class="form-control" placeholder="Password" />

                <div>

                    <div class="modal-footer">
                        
                        <br />
                        <br />
                        <button type="button" class="btn btn-news" data-dismiss="modal"><i class="glyphicon glyphicon-remove"></i> Close</button>
                        <button id="btnLogin" type="button" class="btn btn-news2">Login</button>
                        <br />
                        <label id="lblloginmessage" style="color:red"></label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <section id="HomeMaster"></section>
    <!-----------------------------HEADER VIEWS START----------------------------------->
    <!-- DESKTOP VIEW -->
    <div style="background:linear-gradient(rgba(01,01,01,1),rgba(160,82,45,0.5)),url(images/IMG_9927.jpg);background-size:cover;background-repeat:no-repeat;background-position:top;margin-bottom:0px">
        <div class="container text-center">
            <div class="col-lg-12 text-left" style="padding-top:100px;padding-bottom:25px">
                <h1 style="color:white;font-family:'chiser';font-size:50px"><b>Shipping and Payment</b></h1>
            </div>
        </div><!-- /container -->

    </div><!-- /headerwrap -->
    <!-----------------------------HEADER VIEWS END----------------------------------->

    <div class="col-lg-8 col-lg-offset-2" style="padding-left:10%;padding-right:10%;padding-top:4%;margin-bottom:5%">


        <!--<div class="col-lg-12 text-left alert alert-info" style="margin-bottom:5%">

           <h4 style="font-family:'chiser'">For a faster checkout experience, <a style="font-size:large" data-toggle='modal' data-target='#loginmodal' class="text-info" href="#"><b>log into your account</b></a></h4>
           <span style="font-size:medium;font-family:'chiser';font-style:italic"><i class="glyphicon glyphicon-info-sign"></i> Don't have one? No worries! Simply check 'save my details' at the end of the form.</span>
        </div>-->


        <div class="col-lg-6 text-left" style="font-family:'chiser'">
            <h4 style="font-family:'chiser'"><b>Shipping Details</b> </h4>
            <input id="txtEmailAddress" class="form-control" placeholder="Email Address"/>
            <br />
            <input id="txtFirstName" class="form-control" placeholder="First Name" />
            <br />
            <input id="txtLastName" class="form-control" placeholder="Last Name" />
            <br />
            <input id="txtStreet" class="form-control" placeholder="Street Address" />
            <br />
            <input id="txtCity" class="form-control" placeholder="City" />
            <br />
            <input id="txtState" class="form-control" placeholder="State" />
            <br />
            <input id="txtZip" class="form-control" placeholder="Zip" />
        </div>
        <div class="col-lg-6 text-left" style="font-family:'chiser'">
            <h4 style=" font-family:'chiser'">
            <b>Payment Details</b> </h4>
            <input id="ccNbr" class="form-control" placeholder="Credit Card Number" />
            <br />
            <input id="ccExMonth" class="form-control" placeholder="2 Digit Expiration Month" />
            <br />
            <input id="ccExYear" class="form-control" placeholder="2 Digit Expiration Year" />
            <br />
            <input id="ccSecCode" class="form-control" placeholder="Card Security Code" />
            <br />
            <!--<input id="cbSaveMyDetails" type="checkbox"/> Save My Details
            <br />
            <br />
            <input id="txtPassword" type="password" class="form-control" placeholder="Password"/>-->
        </div>
        <div class="col-lg-12 text-left" style="font-family:'chiser';margin-top:5%">
            <hr />
            <h4 style=" font-family:'chiser'">
                <b>Payment Summary</b>
            </h4>
            <h4 style="font-family:'chiser'">Sub Total:$<span id="txtsubtotal"></span></h4>
            <h4 style="font-family:'chiser'">Discount: -$<span id="txtdiscount"></span></h4>
            <h4 style="font-family:'chiser'">Shipping:$<span id="txtShippingRate"></span></h4>
            <h4 style="font-family:'chiser'">Tax:$<span id="taxprice"></span></h4>
            <h4 style="font-family:'chiser'">Grand Total:$<span id="txtgrandtotal"></span></h4>
            <br />
            <a href="#" id="btnSubmitOrder" class="btn btn-primary">Submit Order</a>
            <br />
            <br />
            <label id="paymentmsg" style="color:red"></label>
        </div>
        


    </div>



    <!-- Placed at the end of the document so the pages load faster -->


    <script src="js/jquery.min.js" type="text/javascript"></script>
    <script src="js/bootstrap.min.js" type="text/javascript"></script>
    <script src="js/main.js" type="text/javascript"></script>
    <script src="js/smoothscroll.js" type="text/javascript"></script>
    <script src="js/url.js" type="text/javascript"></script>


    <script>

        $(document).ready(function () {


            $("#txtPassword").hide();
            var _IsLoggedIn = false;
            // page load details
            var sPageURL = window.location.href
            var subtotal = window.url('?subtotal', sPageURL);
            var discount = window.url('#discount', sPageURL);
            $("#txtsubtotal").text(subtotal);
            $("#txtdiscount").text(discount);
            GetShipping();
           // IsUserLoggedIn();


            var SaveUser = false;

            $("#cbSaveMyDetails").change(function () {

                if ($(this).is(':checked')) {
                   // alert("This is checked");
                    $("#txtPassword").show();
                    SaveUser = true;
                   // alert(SaveUser);
                    
                } else {
                   // alert("This is not checked");
                    $("#txtPassword").hide();
                    SaveUser = false;
                   // alert(SaveUser);
                }

            })



            function IsUserLoggedIn() {

                $.ajax({
                    type: "POST",
                    url: "Engine.asmx/GetUserDetails",
                    data: "{}",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        var result = data.d;

                        if (result = 0) {

                        } else {
                            ClearForm();
                            _IsLoggedIn == true;
                            $.each(result, function (index, item) {


                            })
                        }
                    },
                    failure: function (msg) {
                        alert(msg);
                    },
                    error: function (err) {
                        alert(err);
                    }
                }) //end ajax
            }


            function ClearForm() {
                    
               // To Do: Clear out all form fields.

            }


            function GetShipping() {
                $.ajax({
                    type: "POST",
                    url: "Engine.asmx/GetShippingRate",
                    data: "{}",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        var result = data.d;
                        $("#txtShippingRate").text(result);
                      GetTAX()
                    },
                    failure: function (msg) {
                        alert(msg);
                    },
                    error: function (err) {
                        alert(err);
                    }
                }) //end ajax
            }

            function GetTAX() {

                $.ajax({
                    type: "POST",
                    url: "Engine.asmx/GetTAXPercentage",
                    data: "{SubTotal:'" + subtotal + "',Discount:'" + discount + "'}",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        var result = data.d;
                        $("#taxprice").text(result);

                        //var subttl = parseFloat($("#subtotal").text());
                        //var shipttl = parseFloat($("#shippingprice").text());
                        //var discount = parseFloat($("#discount").text());
                        //// var tax = parseFloat($("#taxprice").text)
                        //var ttl = (subttl + result + shipttl) - discount;
                        //alert(ttl);

                        //var numb = parseFloat(ttl)
                        //$("#total").text(numb.toFixed(2));

                        var grandtotal = (parseFloat(subtotal) + parseFloat($("#txtShippingRate").text()) + result) - parseFloat(discount);
                        $("#txtgrandtotal").text((grandtotal).toFixed(2));
                        
                    },
                    failure: function (msg) {
                        alert(msg);
                    },
                    error: function (err) {
                        alert(err);
                    }
                }) //end ajax

            }

            // end page load details

            var _User;
            var _Email;
            
            getCartCount();

            $("#btnLogin").click(function (e) {
                e.preventDefault();
                var Email = $("#txtLoginEmail").val();
                var Password = $("#txtLoginPassword").val();

                $.ajax({
                    type: "POST",
                    url: "Engine.asmx/LoginUser",
                    data: "{Email:'"+ Email +"',Password:'"+ Password +"'}",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        var result = data.d;
                        _IsLoggedIn == true;
                        $.each(result, function (index, item) {

                            _User = item.UserID;
                            // set field value equal to members pertinent information
                            
 
                        })

                    },
                    failure: function (msg) {
                        alert(msg);
                    },
                    error: function (err) {
                        alert(err);
                    }
                }) //end ajax


                
            })




            $("#btnSubmitOrder").click(function (e) {
                e.preventDefault();

               
                // if logged in is true then don't worry about validating payment info fields
                // but we will still need to check shipping info. 

                $("#paymentmsg").text(" ");

                var Email = $("#txtEmailAddress");
                var FirstName = $("#txtFirstName");
                var LastName = $("#txtLastName");
                var Street = $("#txtStreet");
                var City = $("#txtCity");
                var State = $("#txtState");
                var Zip = $("#txtZip");

                $(Email).css("border-color", "#ccc");
                $(FirstName).css("border-color", "#ccc");
                $(LastName).css("border-color", "#ccc");
                $(Street).css("border-color", "#ccc");
                $(City).css("border-color", "#ccc");
                $(State).css("border-color", "#ccc");
                $(Zip).css("border-color", "#ccc");

                if ($.trim($(Email).val()) == "") {
                    $("#paymentmsg").text("Please provide a valid email address.");
                    $(Email).css("border-color", "red");
                    return;
                }
                if ($.trim($(FirstName).val()) == "") {
                    $("#paymentmsg").text("Please provide a valid first name.");
                    $(FirstName).css("border-color", "red");
                    return;
                }
                if ($.trim($(LastName).val()) == "") {
                    $("#paymentmsg").text("Please provide a valid last name.");
                    $(LastName).css("border-color", "red");
                    return;
                }
                if ($.trim($(Street).val()) == "") {
                    $("#paymentmsg").text("Please provide a valid street address.");
                    $(Street).css("border-color", "red");
                    return;
                }
                if ($.trim($(City).val()) == "") {
                    $("#paymentmsg").text("Please provide a valid city.");
                    $(City).css("border-color", "red");
                    return;
                }
                if ($.trim($(State).val()) == "") {
                    $("#paymentmsg").text("Please provide a valid state.");
                    $(State).css("border-color", "red");
                    return;
                }
                if ($.trim($(Zip).val()) == "") {
                    $("#paymentmsg").text("Please provide a valid zipcode.");
                    $(Zip).css("border-color", "red");
                    return;
                }

                //if (_IsLoggedIn == true) {

                //} else {
                //    if ($("#cbSaveMyDetails").is(":checked")) {
                //        //create account before charging  card
                //    } else {
                //       // just charge card
                //    }
                //}

              //  CheckoutAsGuest(ByVal Email As String, ByVal FirstName As String, ByVal LastName As String, ByVal Street As String, ByVal City As String, ByVal State As String, ByVal Zipcode As String, ByVal CC As String, ByVal ccMonth As String, ByVal ccYear As String, ByVal ccSecurity As String, ByVal saveDetails As Boolean, ByVal SubTotal As String, ByVal Discount As String, ByVal Shipping As String, ByVal Tax As String, ByVal TotalToCharge As String)
                    
                var ccnum = $("#ccNbr").val();
                var exmonth = $("#ccExMonth").val();
                var exyear = $("#ccExYear").val();
                var seccode = $("#ccSecCode").val();
                var savedetails = false;

                //if ($("#cbSaveMyDetails").is(":checked")) {
                //    savedetails = true;
                //}
                
                $.ajax({
                    type: "POST",
                    url: "Engine.asmx/CheckoutAsGuest",
                    data: "{Email:'" + $("#txtEmailAddress").val() + "',Password:'"+ $("#txtPassword").val() +"',FirstName:'" + $("#txtFirstName").val() +
                           "',LastName:'" + $("#txtLastName").val() + "',Street:'" + $("#txtStreet").val() +
                           "',City:'" + $("#txtCity").val() + "',State:'" + $("#txtState").val() + "',Zipcode:'" + $("#txtZip").val() +
                           "',CC:'" + ccnum + "',ccMonth:'" + exmonth + "',ccYear:'" + exyear + "',ccSecurity:'" + seccode +
                           "',saveDetails:" + SaveUser + ",SubTotal:'" + $("#txtsubtotal").text() + "',Discount:'" + $("#txtdiscount").text() + "',Shipping:'" + $("#txtShippingRate").text() +
                           "',Tax:'" + $("#taxprice").text() + "',TotalToCharge:'" + $("#txtgrandtotal").text() + "'}",

                   
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        var result = data.d;
                       
                        window.location.href = "index.html"
                        // Clear Form
                        // Empty Cart
                        // Redirect to Thank You Page

                    },
                    failure: function (msg) {
                        alert(msg);
                    },
                    error: function (err) {
                        alert(err);
                    }
                }) //end ajax
                  

            })

            function getCartCount() {

                $.ajax({
                    type: "POST",
                    url: "Engine.asmx/GetCartCount",
                    data: "{}",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        var result = data.d;


                        $("#cartcount").text(result);
                        $("#cartcount2").text(result);

                    },
                    failure: function (msg) {
                        alert(msg);
                    },
                    error: function (err) {
                        alert(err);
                    }
                }) //end ajax
            }



            $(".smoothScroll").click(function () {
                $(this).css("background-color", "transparent");
            })



        })



    </script>


</body>
</html>