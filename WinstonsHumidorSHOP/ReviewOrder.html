<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>Home | Winston's Humidor</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap core CSS -->
    <link href="css/style.css" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet" />
    <link href="css/font-awesome.min.css" rel="stylesheet" />


</head>

<body style="background-color:white">


    <nav class="menu" id="theMenu">
        <div class="menu-wrap">
            <h1 class="logo"><img src="images/WinstonHumidor_Cigar_Brown(2).png" class="img-responsive center-block" style="max-width:100px" /></h1>
            <i class="icon-remove menu-close"></i>
            <a href="#HomeMaster" class="smoothScroll">Home</a>
            <a href="Cigars.html" class="smoothScroll">Cigars</a>
            <a href="Pipes.html" class="smoothScroll">Pipes</a>
            <a href="PipeTobacco.html" class="smoothScroll">Pipe Tobacco</a>
            <a href="Apparel.html" class="smoothScroll">Apparel</a>
            <a href="Accessories.html" class="smoothScroll">Accessories</a>
            <a href="Co.html" class="smoothScroll">Coffee</a>
            <a href="Cart.html" class="smoothScroll">Cart</a>
            <a href="#"><i class="icon-facebook"></i></a>
            <a href="#"><i class="icon-twitter"></i></a>
            <a href="#"><i class="icon-instagram"></i></a>

        </div>

        <!-- Menu button -->
        <div id="menuToggle"><i class="icon-reorder"></i></div>
    </nav>



    <section id="HomeMaster"></section>
    <!-----------------------------HEADER VIEWS START----------------------------------->
    <!-- DESKTOP VIEW -->
    <div style="background:linear-gradient(rgba(01,01,01,1),rgba(160,82,45,0.5)),url(images/IMG_9927.jpg);background-size:cover;background-repeat:no-repeat;background-position:top;margin-bottom:0px">
        <div class="container text-center">
            <div class="col-lg-12 text-left" style="padding-top:100px;padding-bottom:25px">
                <h1 style="color:white;font-family:'chiser';font-size:50px"><b>Review Order</b></h1>
            </div>
        </div><!-- /container -->

    </div><!-- /headerwrap -->
    <!-----------------------------HEADER VIEWS END----------------------------------->

    <div class="col-lg-8 col-lg-offset-2" style="padding-left:10%;padding-right:10%;padding-top:4%;margin-bottom:5%">


        


                <table id="CartReviewTable" class="table table-responsive">
                    <!--<tr>
                        <th>Product</th>
                        <th>Quantity</th>
                        <th>Price</th>
                        <th></th>
                        <th></th>
                    </tr>
                 
                    <tr>
                       
                        <td><h4 style="font-family:'chiser'">Display Name</h4></td>
                        <td style="padding-top:15px"><input style="max-width:50px" class="form-control" /></td>
                        <td><h4 style="font-family:'chiser'">$100.50</h4></td>
                        <td style="padding-top:15px">
                       
                            <a href="#" class="btn btn-sm btn-danger"><i class="glyphicon glyphicon-trash"></i></a>
                     
                        
                      </td>
                        <td style="padding-top:15px">
                            <a href="#" class="btn btn-sm btn-success"><i class="glyphicon glyphicon-ok"></i></a>
                        </td>
                    </tr>-->
                
            
                </table>
        <label id="lblMsg" style="color:red"></label>
        <hr />
        <h4 style="font-family:'chiser'" >Discount Code</h4>
        <input id="txtDiscountCode" style="font-family:'chiser'" placeholder="enter code" class="form-control" />
        
     
       
        <div class="col-lg-12 text-right">
            <a id="btnDiscountCode" style="margin-top:12px;margin-bottom:12px" href="#" class="btn btn-sm btn-primary">Apply Code</a>
            <h4 style="font-family:'chiser'">Sub Total: $<span id="subtotal"></span> </h4>
            <h4 style="font-family:'chiser';color:red">Discount: -$<span  id="discount"></span> </h4>
            <h4 style="font-family:'chiser'">Shipping: $<span id="shippingprice"></span></h4>
            <h4 style="font-family:'chiser'"><b>Total: $<span id="total"></span></b></h4>
            <a href="#" id="btnContinue" style="margin-top:12px"  class="btn btn-sm btn-primary"> Continue</a>
        </div>
     


               
              
               
         


    
      
        
           

    
        </div>



    <!-- Placed at the end of the document so the pages load faster -->


    <script src="js/jquery.min.js" type="text/javascript"></script>
    <script src="js/bootstrap.min.js" type="text/javascript"></script>
    <script src="js/main.js" type="text/javascript"></script>
    <script src="js/smoothscroll.js" type="text/javascript"></script>



    <script>

        $(document).ready(function () {
            $("#discount").text("0.00");
            $("#lblMsg").text("");
               
                $("#CartReviewTable").empty();
                $.ajax({
                    type: "POST",
                    url: "Engine.asmx/GoToCart",
                    data: "{}",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        var result = data.d;

                        if (result == 0) {
                            return;
                        }


                        $("#CartReviewTable").empty();
                        var theader = " <tr><th>Product</th><th>Quantity</th><th>Price</th><th></th><th></th></tr>"
                        $(theader).appendTo("#CartReviewTable");

                        $.each(result, function (index, item) {
                           
                         
                     
                            var content = " <tr data-lastqty="+ item.Qty +" id="+ item.ItemName +"><td><h4 style='font-family:arial'><b>" + item.ItemName + "  "+ item.Notes +"</b></h4></td> " +
                                          " <td style='padding-top:15px'><input style='max-width:50px' value="+ item.Qty +" class='form-control inputqty' /></td> " +
                                          " <td><h4 style='font-family:arial'>$" + item.Price + "</h4></td> " +
                                          " <td style='padding-top:15px'> " +
                                          " <a href='#' data-price='"+ item.Price +"' data-qty="+ item.Qty +" data-notes='"+ item.Notes  +"' data-productid="+ item.ProductID +"  class='btn btn-sm btn-danger removeitem'><i class='glyphicon glyphicon-trash'></i></a> " +
                                          " </td><td style='padding-top:15px'><a href='#' data-notes='" + item.Notes + "' data-productid=" + item.ProductID + " class='btn btn-sm btn-success updateitem'><i class='glyphicon glyphicon-ok'></i></a></td></tr> "

                            $(content).appendTo("#CartReviewTable");

                        })

                        getCartTotal();

                    },
                    failure: function (msg) {
                        alert(msg);
                    },
                    error: function (err) {
                        alert(err);
                    }
                }) //end ajax
          
                var _dAmount;
                $("#btnDiscountCode").click(function () {
                    $("#lblMsg").text("");
                    $.ajax({
                        type: "POST",
                        url: "Engine.asmx/ApplyDiscount",
                        data: "{DiscountCode:'" + $("#txtDiscountCode").val() + "'}",
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (data) {
                            var result = data.d;

                            if (result == 0) {
                                $("#lblMsg").text("Discount code is invalid.");
                                return;
                            } else {

                                _dAmount = result
                               //(_dAmount).toFixed(2);
                                $("#discount").text((_dAmount).toFixed(2));
                           
                                applydiscount(_dAmount);
                            }
                            

                        },
                        failure: function (msg) {
                            alert(msg);
                        },
                        error: function (err) {
                            alert(err);
                        }
                    }) //end ajax

                })


                function applydiscount(amount) {
                   // $("#total").text("0.00");
                    
                    var beforeTtl = $("#total").text()
                    var afterDiscount = beforeTtl - amount
                    var discountformat = (afterDiscount).toFixed(2);
                    $("#total").text(discountformat);

                }



                $("#btnContinue").click(function () {

                    var subtotal = $("#subtotal").text();
                    var discount = $("#discount").text();
                    var grandtotal = $("#total").text();

                    window.location.href = "ShippingAndPayment.html?subtotal="+ subtotal + "&discount="+ discount + "&grandtotal="+ grandtotal 


                })


                function updateTotal(Product,Notes,Qty){
                    $.ajax({
                        type: "POST",
                        url: "Engine.asmx/UpdateItemTotal",
                        data: "{ProdID:'"+ Product +"',Notes:'"+ Notes +"',DesiredQty:'"+ Qty +"'}",
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (data) {
                            var result = data.d;

                            if (result == 0) {

                                return;
                            }

                       
                        },
                        failure: function (msg) {
                            alert(msg);
                        },
                        error: function (err) {
                            alert(err);
                        }
                    }) //end ajax
                }


               // UpdateItemTotal(ByVal ProdID As Integer, ByVal Notes As String, ByVal Price As String, ByVal DesiredQty As String)

                function whatsinmycart() {
                    $("#CartReviewTable").empty();
                    $.ajax({
                        type: "POST",
                        url: "Engine.asmx/GoToCart",
                        data: "{}",
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (data) {
                            var result = data.d;

                            if (result == 0) {
                                return;
                            }


                            $("#CartReviewTable").empty();
                            var theader = " <tr><th>Product</th><th>Quantity</th><th>Price</th><th></th><th></th></tr>"
                            $(theader).appendTo("#CartReviewTable");

                            $.each(result, function (index, item) {

                                

                                var content = " <tr data-lastqty=" + item.Qty + " id=" + item.ItemName + "><td><h4 style='font-family:arial'><b>" + item.ItemName + "  " + item.Notes + "</b></h4></td> " +
                                           " <td style='padding-top:15px'><input style='max-width:50px' value=" + item.Qty + " class='form-control inputqty' /></td> " +
                                           " <td><h4 style='font-family:arial'>$" + item.Price + "</h4></td> " +
                                           " <td style='padding-top:15px'> " +
                                           " <a href='#' data-price='" + item.Price + "' data-qty=" + item.Qty + " data-notes='" + item.Notes + "' data-productid=" + item.ProductID + "  class='btn btn-sm btn-danger removeitem'><i class='glyphicon glyphicon-trash'></i></a> " +
                                           " </td><td style='padding-top:15px'><a href='#' data-notes='" + item.Notes + "' data-productid=" + item.ProductID + " class='btn btn-sm btn-success updateitem'><i class='glyphicon glyphicon-ok'></i></a></td></tr> "

                                $(content).appendTo("#CartReviewTable");

                            })

                            getCartTotal();

                        },
                        failure: function (msg) {
                            alert(msg);
                        },
                        error: function (err) {
                            alert(err);
                        }
                    }) //end ajax
                }



                $("#CartReviewTable").delegate('.updateitem', "click", function () {
                    $("#lblMsg").text("");
                   // alert($(".inputqty").val());
                    var disc = $(this).closest('tr');
                    var valz = disc.find('.inputqty')
                    var desiredqty = valz.val();
                    var lastqty = $(disc).attr('data-lastqty');

                    if (desiredqty == 0) {
                        $("#lblMsg").text("You have set qty to 0. If this is correct, simply click the 'trash' button to remove item from your cart.");
                        valz.val(lastqty);
                        return;
                    }
                   
                    var prod = $(this).attr('data-productid');
                    var notes = $(this).attr('data-notes');


                    updateTotal(prod, notes, desiredqty);
                    whatsinmycart();
                    getCartTotal();
                    getCartCount();
                   
                   

                })

                $("#CartReviewTable").delegate('.removeitem', "click", function () {

                    var removeitemnbr = $(this).attr('data-productid');
                    var notes = $(this).attr('data-notes');
                    var qty = $(this).attr('data-qty');
                    var price = $(this).attr('data-price');




                    $.ajax({
                        type: "POST",
                        url: "Engine.asmx/RemoveItemFromCart",
                        data: "{ProdID:" + removeitemnbr + ",Notes:'" + notes + "',Qty:'" + qty + "',Price:'" + price + "'}",
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (data) {
                            var result = data.d;
                            whatsinmycart();
                            getCartTotal();
                            getCartCount();

                        },
                        failure: function (msg) {
                            alert(msg);
                        },
                        error: function (err) {
                            alert(err);
                        }
                    }) //end ajax
                })



                function getCartCount() {

                    $.ajax({
                        type: "POST",
                        url: "Engine.asmx/GetCartCount",
                        data: "{}",
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (data) {
                            var result = data.d;


                            $("#cartcount").text(result);
                            $("#cartcount2").text(result);

                        },
                        failure: function (msg) {
                            alert(msg);
                        },
                        error: function (err) {
                            alert(err);
                        }
                    }) //end ajax
                }

                function getCartTotal() {

                    $.ajax({
                        type: "POST",
                        url: "Engine.asmx/GetCartTotal",
                        data: "{}",
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (data) {
                            var result = data.d;

                            if (result == 0) {
                                $("#subtotal").text("0.00");
                                $("#total").text("0.00");
                                $("#discount").text("0.00");
                                return;
                            }

                            $("#subtotal").text(result.toFixed(2));
                            $("#shippingprice").text("25.00");
                            var subttl = parseFloat($("#subtotal").text());
                            var shipttl = parseFloat($("#shippingprice").text());
                            var discount = parseFloat($("#discount").text());
                            var ttl = (subttl + shipttl) - discount;
                            

                            var numb = parseFloat(ttl)
                            $("#total").text(numb.toFixed(2));
                            


                        },
                        failure: function (msg) {
                            alert(msg);
                        },
                        error: function (err) {
                            alert(err);
                        }
                    }) //end ajax

                }

        })
    </script>


</body>
</html>